<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Your Store</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="profile.css">
</head>
<body>
    <div class="container">
        <!-- Sign Up Form -->
        <div class="form-container sign-up" id="signUpForm">
            <h2>Create Account</h2>
            <form onsubmit="handleSignUp(event)">
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" name="name" placeholder="Full Name" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" name="email" placeholder="Email" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-phone"></i>
                    <input type="tel" name="phone" placeholder="Phone Number" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-map-marker-alt"></i>
                    <input type="text" name="address" placeholder="Address" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" name="password" placeholder="Password" required>
                </div>
                <button type="submit" class="btn">Sign Up</button>
            </form>
            <p>Already have an account? <a href="#" onclick="toggleForms('signin')">Sign In</a></p>
        </div>

        <!-- Sign In Form -->
        <div class="form-container sign-in" id="signInForm" style="display: none;">
            <h2>Welcome Back</h2>
            <form onsubmit="handleSignIn(event)">
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" name="email" placeholder="Email" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" name="password" placeholder="Password" required>
                </div>
                <div class="checkbox-container">
                    <label class="checkbox-label">
                        <input type="checkbox" id="adminCheckbox" name="isAdmin">
                        <span class="checkbox-text">Login as Admin</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="vendorCheckbox" name="isVendor">
                        <span class="checkbox-text">Login as Vendor</span>
                    </label>
                </div>
                <button type="submit" class="btn">Sign In</button>
            </form>
            <p>Don't have an account? <a href="#" onclick="toggleForms('signup')">Sign Up</a></p>
            <p>Want to sell? <a href="vendor-registration.html">Register as Vendor</a></p>
        </div>
    </div>

    <script src="profile.js"></script>
    <script>
    // Handle sign in
    async function handleSignIn(event) {
        event.preventDefault();
        const form = event.target;
        const formData = new FormData(form);
        
        const isAdmin = document.getElementById('adminCheckbox').checked;
        const isVendor = document.getElementById('vendorCheckbox').checked;
        
        const data = {
            email: formData.get('email'),
            password: formData.get('password')
        };

        try {
            const response = await fetch('http://localhost:5506/api/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });

            const result = await response.json();

            if (response.ok) {
                // Check if user role matches selected checkbox
                if (isAdmin && result.user.role !== 'admin') {
                    showError('Access denied. Admin privileges required.');
                    return;
                }
                if (isVendor && result.user.role !== 'vendor') {
                    showError('Access denied. Vendor privileges required.');
                    return;
                }
                if (!isAdmin && !isVendor && result.user.role !== 'user') {
                    showError('Please select the appropriate role to login.');
                    return;
                }

                // Store auth data
                localStorage.setItem('token', result.token);
                localStorage.setItem('userRole', result.user.role);
                localStorage.setItem('userName', result.user.name);
                localStorage.setItem('userEmail', result.user.email);
                
                showSuccess('Login successful! Redirecting...');
                
                // Redirect based on role and checkbox
                setTimeout(() => {
                    if (isAdmin && result.user.role === 'admin') {
                        window.location.href = 'admin-dashboard.html';
                    } else if (isVendor && result.user.role === 'vendor') {
                        window.location.href = 'vendor-dashboard.html';
                    } else {
                        window.location.href = 'index.html';
                    }
                }, 1000);
            } else {
                showError(result.error || 'Login failed');
            }
        } catch (error) {
            console.error('Login error:', error);
            showError('Connection error. Please try again.');
        }
    }

    // Ensure only one checkbox can be checked at a time
    document.getElementById('adminCheckbox').addEventListener('change', function() {
        if (this.checked) {
            document.getElementById('vendorCheckbox').checked = false;
        }
    });

    document.getElementById('vendorCheckbox').addEventListener('change', function() {
        if (this.checked) {
            document.getElementById('adminCheckbox').checked = false;
        }
    });

    // Auto-fill email and check vendor checkbox if coming from registration
    if (window.location.hash === '#signin') {
        const vendorEmail = localStorage.getItem('vendorEmail');
        if (vendorEmail) {
            const emailInput = document.querySelector('input[name="email"]');
            const vendorCheckbox = document.getElementById('vendorCheckbox');
            if (emailInput) {
                emailInput.value = vendorEmail;
            }
            if (vendorCheckbox) {
                vendorCheckbox.checked = true;
            }
        }
    }

    function showError(message) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-message';
        errorDiv.textContent = message;
        
        const form = document.querySelector('form');
        form.insertBefore(errorDiv, form.firstChild);
        
        setTimeout(() => errorDiv.remove(), 3000);
    }

    function showSuccess(message) {
        const successDiv = document.createElement('div');
        successDiv.className = 'success-message';
        successDiv.textContent = message;
        
        const form = document.querySelector('form');
        form.insertBefore(successDiv, form.firstChild);
        
        setTimeout(() => successDiv.remove(), 3000);
    }
    </script>
</body>
</html> 